# V2 Hook Configuration for {{ project_name }}
# Replaces V1 agent spawning with programmatic automation
# Based on VESPERA_VISION_PLANNING_WORKSHEET.md priorities

hook_registry_id: "{{ project_name }}-hooks"
project_name: "{{ project_name }}"
created_date: "{{ _copier_answers._now }}"

# Hook Definitions (Ordered by Priority)
hooks:

{% if enable_git_hooks %}
  # Priority 9 (High): Git Operations - V1 Agent Replacement
  - id: "{{ project_name }}-git-branch-creation"
    name: "Automated Git Branch Management"
    description: "Replaces V1 git agent spawning with automated branch operations"
    priority: "HIGH"  # Priority 9 from worksheet
    
    trigger:
      type: "TASK_STATUS"
      conditions:
        status: "started"
        task_type: ["implementation", "research", "design"]
    
    actions:
      - type: "PROGRAMMATIC"
        implementation: "hooks.actions.git_operations.create_branch"
        parameters:
          branch_prefix: "{{ feature_branch_prefix if use_feature_branch else 'task/' }}"
          auto_create: {{ use_feature_branch | lower }}
          naming_pattern: "{prefix}{task_id}"
        
        # V1 Agent Replacement: Instead of spawning git agent
        replacement_for: "V1 git_operations_agent spawning"
        v1_equivalent: "orchestrator_plan_task with git specialist"

  - id: "{{ project_name }}-git-commit-reminders"
    name: "Commit Progress Preservation"
    description: "Automated reminders to preserve work (executive dysfunction support)"
    priority: "HIGH"  # Priority 9
    
    trigger:
      type: "TIME_BASED"
      conditions:
        interval_minutes: 30
        only_when_active: true
    
    actions:
      - type: "PROGRAMMATIC"
        implementation: "hooks.actions.git_operations.remind_commit_progress"
        parameters:
          check_uncommitted_files: true
          reminder_message: "‚è∞ Automated reminder: Consider committing your progress to preserve work"
          create_wip_commit: false  # Just remind, don't auto-commit
        
        replacement_for: "V1 auto-preservation WIP commits"
        executive_dysfunction_support: true

  - id: "{{ project_name }}-git-completion-gate"
    name: "Git Status Validation Gate"
    description: "Prevents task completion with uncommitted changes"
    priority: "CRITICAL"  # Priority 10
    
    trigger:
      type: "TASK_STATUS"
      conditions:
        status: "completion_attempt"
    
    actions:
      - type: "PROGRAMMATIC"
        implementation: "hooks.actions.git_operations.validate_commit_status"
        parameters:
          block_completion_if_uncommitted: true
          reminder_message: "‚ö†Ô∏è Please commit all changes before completing this task"
          suggest_commands: ["git add -A", "git commit -m 'feat({{ project_name }}): task completion'"]
        
        replacement_for: "V1 manual git status checking"
        prevents_known_failure: "Completing tasks with uncommitted work"
{% endif %}

{% if enable_testing_hooks %}
  # Priority 8 (Normal): Test Execution Reminders - V1 Testing Agent Replacement
  - id: "{{ project_name }}-test-after-code-changes"
    name: "Automated Test Execution Reminders"
    description: "Replaces V1 testing agent with automated test reminders"
    priority: "NORMAL"  # Priority 8
    
    trigger:
      type: "FILE_CHANGE"
      conditions:
        file_patterns: ["*.py", "*.js", "*.ts", "*.jsx", "*.tsx"]
        change_types: ["modified", "created"]
    
    actions:
      - type: "PROGRAMMATIC"
        implementation: "hooks.actions.testing.remind_test_execution"
        parameters:
          test_scope: "related"
          reminder_message: "üß™ Code changes detected. Consider running tests:"
          suggested_commands:
            - "python run_tests.py --suite related"
            - "pytest tests/unit/ -v"
            - "npm test"
          
          # V1 Integration: Instead of spawning testing agent
          run_tests_automatically: false  # Remind only, don't auto-run
        
        replacement_for: "V1 testing_implementation_agent spawning"
        v1_equivalent: "orchestrator_execute_task with tester specialist"

  - id: "{{ project_name }}-test-completion-validation"
    name: "Test Coverage Validation"
    description: "Ensures adequate test coverage before task completion"
    priority: "NORMAL"  # Priority 8
    
    trigger:
      type: "TASK_STATUS"
      conditions:
        status: "completion_attempt"
        task_role: ["developer", "coder"]
    
    actions:
      - type: "PROGRAMMATIC"
        implementation: "hooks.actions.testing.validate_test_coverage"
        parameters:
          minimum_coverage: 80
          block_completion_if_insufficient: {{ "true" if complexity_level in ["complex", "comprehensive"] else "false" }}
          reminder_message: "üìä Test coverage validation required before completing development tasks"
          coverage_report_command: "pytest --cov=src --cov-report=term-missing"
        
        replacement_for: "V1 manual test coverage checking"
        quality_gate: true
{% endif %}

{% if enable_security_hooks %}
  # Priority 10 (Critical): Security Validation - V1 Security Agent Replacement
  - id: "{{ project_name }}-security-design-review"
    name: "Automated Security Design Validation"
    description: "Replaces V1 security agent with automated security checks"
    priority: "CRITICAL"  # Priority 10
    
    trigger:
      type: "TASK_STATUS"
      conditions:
        status: "started"
        task_type: ["design", "architecture"]
    
    actions:
      - type: "PROGRAMMATIC"
        implementation: "hooks.actions.security.validate_design_security"
        parameters:
          security_checklist:
            - "Authentication and authorization patterns reviewed"
            - "Input validation strategies defined"  
            - "Data encryption and storage security considered"
            - "API security measures documented"
          
          reminder_message: "üîí Security design validation checklist activated"
          block_progress_until_reviewed: {{ "true" if enable_security_hooks else "false" }}
        
        replacement_for: "V1 security_design_agent spawning"
        v1_equivalent: "orchestrator_execute_task with reviewer specialist"

  - id: "{{ project_name }}-security-implementation-scan"
    name: "Security Vulnerability Scanning"
    description: "Automated security scanning during implementation"
    priority: "CRITICAL"  # Priority 10
    
    trigger:
      type: "TASK_STATUS" 
      conditions:
        status: "completion_attempt"
        task_type: ["implementation"]
    
    actions:
      - type: "PROGRAMMATIC"
        implementation: "hooks.actions.security.run_security_scan"
        parameters:
          scan_tools: ["bandit", "safety", "semgrep"]
          block_completion_on_high_severity: true
          generate_security_report: true
          report_location: "security-reports/{{ project_name }}-scan.json"
        
        replacement_for: "V1 security_validation_agent spawning"
        prevents_known_failure: "Deploying code with security vulnerabilities"
{% endif %}

{% if enable_documentation_hooks %}
  # Priority 7 (Low): Documentation Updates - V1 Documentation Agent Replacement
  - id: "{{ project_name }}-documentation-sync"
    name: "Automated Documentation Sync"
    description: "Replaces V1 documentation agent with automated doc updates"
    priority: "LOW"  # Priority 7
    
    trigger:
      type: "TASK_STATUS"
      conditions:
        status: "completed"
        task_role: ["architect", "developer"]
    
    actions:
      - type: "PROGRAMMATIC"
        implementation: "hooks.actions.documentation.sync_documentation"
        parameters:
          auto_update_files: ["README.md", "ARCHITECTURE.md", "API_DOCS.md"]
          generate_changelog_entry: true
          reminder_message: "üìö Documentation sync recommended after architecture/development changes"
          
          # V1 Pattern: Instead of spawning documentation agent
          create_doc_tasks: false  # Just remind, don't auto-generate
        
        replacement_for: "V1 documentation_agent spawning"
        v1_equivalent: "orchestrator_execute_task with documenter specialist"

  - id: "{{ project_name }}-readme-validation"
    name: "README and Documentation Validation"
    description: "Ensures project documentation stays current"
    priority: "LOW"  # Priority 7
    
    trigger:
      type: "TASK_STATUS"
      conditions:
        status: "completion_attempt"
        task_id: "{{ project_name }}-root"  # Only on main task completion
    
    actions:
      - type: "PROGRAMMATIC"
        implementation: "hooks.actions.documentation.validate_documentation_completeness"
        parameters:
          required_sections: ["Installation", "Usage", "API Reference", "Contributing"]
          check_link_validity: true
          reminder_message: "üìñ Final documentation validation before project completion"
        
        replacement_for: "V1 final documentation review agent"
{% endif %}

  # Priority 10 (Critical): File Context Loading - V1 Context Agent Replacement
  - id: "{{ project_name }}-context-loading"
    name: "Automated Context Document Loading"
    description: "Loads relevant context documents based on file types (V1 context agent replacement)"
    priority: "CRITICAL"  # Priority 10
    
    trigger:
      type: "FILE_CHANGE"
      conditions:
        file_patterns: ["*.py", "*.md", "*.yml", "*.json"]
        change_types: ["created", "modified"]
    
    actions:
      - type: "PROGRAMMATIC"
        implementation: "hooks.actions.file_context.load_context_documents"
        parameters:
          # V1 FILE_TYPE_HOOKS integration
          context_mapping:
            "*.py": 
              documents: ["CLAUDE.md", "ARCHITECTURE.md", "requirements.txt"]
              suggested_roles: ["developer", "coder"]
            "*.md":
              documents: ["docs/style-guide.md", "CONTRIBUTING.md"]
              suggested_roles: ["technical_writer"]
            "*.yml":
              documents: [".github/workflows/ci-minimal.yml", "copier.yml"]
              suggested_roles: ["devops_engineer"]
          
          reminder_message: "üìã Context documents loaded for current file type"
        
        replacement_for: "V1 context loading sub-agents"
        v1_equivalent: "FILE_TYPE_HOOKS automatic context loading"

# Hook Engine Configuration
engine_config:
  max_concurrent_hooks: 5
  hook_timeout_seconds: 300
  retry_failed_hooks: 3
  
  # Executive Dysfunction Support
  executive_dysfunction_support:
    enable_progress_preservation: true
    enable_decision_reduction: true
    enable_automated_reminders: {{ "true" if hook_reminder_frequency != "minimal" else "false" }}
    
  # V1 Migration Support
  v1_compatibility:
    simulate_agent_coordination: false  # Don't simulate, use hooks
    preserve_worktree_strategy: {{ use_feature_branch | lower }}
    maintain_systematic_approach: true

# Hook Priorities (from VESPERA_VISION_PLANNING_WORKSHEET.md)
priority_mapping:
  CRITICAL: 10    # File context loading, task breakdown, security gates
  HIGH: 9         # Git operations, dependency tracking
  NORMAL: 8       # Test execution, progress summarization  
  LOW: 7          # Documentation updates
  BACKGROUND: 6   # Code review reminders
  OPTIONAL: 5     # CI/CD integration
  DEFERRED: 4     # Non-critical compliance

# V1 to V2 Migration Summary
migration_summary: |
  This hook configuration replaces V1 meta-PRP agent spawning patterns:
  
  V1 Agent Type                    ‚Üí V2 Hook Replacement
  ================================   ========================
  research_agent                   ‚Üí Context loading hooks
  architecture_agent               ‚Üí Design validation hooks
  implementation_agent             ‚Üí Code quality hooks
  testing_agent                    ‚Üí Test execution reminders
  security_agent                   ‚Üí Security validation hooks
  documentation_agent              ‚Üí Doc sync hooks
  git_operations_agent            ‚Üí Git management hooks
  
  Key V1 Patterns Preserved:
  ‚úÖ Executive dysfunction support via automated reminders
  ‚úÖ Systematic approach with quality gates
  ‚úÖ Hook-based problem prevention
  ‚úÖ Multi-phase workflow coordination
  ‚úÖ Work preservation through git integration