# Circuit Breaker Configuration for External APIs
# Copy this file to .env and configure with your values

# =============================================================================
# API Keys for Embedding Services
# =============================================================================

# OpenAI API Configuration
OPENAI_API_KEY=sk-...
OPENAI_API_BASE_URL=https://api.openai.com/v1/embeddings
OPENAI_MODEL=text-embedding-3-small

# Cohere API Configuration
COHERE_API_KEY=your_cohere_api_key_here
COHERE_API_BASE_URL=https://api.cohere.ai/v1/embed
COHERE_MODEL=embed-english-v3.0

# HuggingFace API Configuration
HF_API_KEY=hf_...
HF_MODEL=sentence-transformers/all-MiniLM-L6-v2

# =============================================================================
# Circuit Breaker Configuration
# =============================================================================

# OpenAI Circuit Breaker Settings
OPENAI_CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
OPENAI_CIRCUIT_BREAKER_RECOVERY_TIMEOUT_SECONDS=30
OPENAI_CIRCUIT_BREAKER_REQUEST_TIMEOUT_SECONDS=30
OPENAI_CIRCUIT_BREAKER_MAX_RETRIES=3
OPENAI_CIRCUIT_BREAKER_INITIAL_BACKOFF_MS=100
OPENAI_CIRCUIT_BREAKER_MAX_BACKOFF_SECONDS=10
OPENAI_CIRCUIT_BREAKER_BACKOFF_MULTIPLIER=2.0
OPENAI_CIRCUIT_BREAKER_SUCCESS_THRESHOLD=3

# Cohere Circuit Breaker Settings
COHERE_CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
COHERE_CIRCUIT_BREAKER_RECOVERY_TIMEOUT_SECONDS=30
COHERE_CIRCUIT_BREAKER_REQUEST_TIMEOUT_SECONDS=30
COHERE_CIRCUIT_BREAKER_MAX_RETRIES=3
COHERE_CIRCUIT_BREAKER_INITIAL_BACKOFF_MS=100
COHERE_CIRCUIT_BREAKER_MAX_BACKOFF_SECONDS=10
COHERE_CIRCUIT_BREAKER_BACKOFF_MULTIPLIER=2.0
COHERE_CIRCUIT_BREAKER_SUCCESS_THRESHOLD=3

# HuggingFace Circuit Breaker Settings
HF_CIRCUIT_BREAKER_FAILURE_THRESHOLD=3
HF_CIRCUIT_BREAKER_RECOVERY_TIMEOUT_SECONDS=60
HF_CIRCUIT_BREAKER_REQUEST_TIMEOUT_SECONDS=60
HF_CIRCUIT_BREAKER_MAX_RETRIES=2
HF_CIRCUIT_BREAKER_INITIAL_BACKOFF_MS=200
HF_CIRCUIT_BREAKER_MAX_BACKOFF_SECONDS=30
HF_CIRCUIT_BREAKER_BACKOFF_MULTIPLIER=1.5
HF_CIRCUIT_BREAKER_SUCCESS_THRESHOLD=2

# =============================================================================
# Fallback Configuration
# =============================================================================

# Enable/disable fallback mechanisms
FALLBACK_ENABLE_MOCK_EMBEDDINGS=true
FALLBACK_ENABLE_KEYWORD_SEARCH=true
FALLBACK_ENABLE_CACHED_RESULTS=true
FALLBACK_ENABLE_FUZZY_MATCHING=true

# Cache settings
FALLBACK_CACHE_MAX_AGE_SECONDS=3600
FALLBACK_FUZZY_THRESHOLD=0.6

# Fallback strategy: mock_embeddings, keyword_search, cached_results, hybrid, none
FALLBACK_STRATEGY=hybrid

# =============================================================================
# Health Monitoring Configuration
# =============================================================================

# Health check intervals
HEALTH_CHECK_INTERVAL_SECONDS=30
HEALTH_CHECK_TIMEOUT_SECONDS=10
HEALTH_FAILURE_THRESHOLD=3
HEALTH_RECOVERY_THRESHOLD=2

# Auto-recovery settings
HEALTH_AUTO_RESET_CIRCUIT_BREAKERS=false
HEALTH_VERBOSE_LOGGING=false

# =============================================================================
# Logging Configuration
# =============================================================================

# Log level: trace, debug, info, warn, error
RUST_LOG=vespera_bindery=info,circuit_breaker_demo=debug

# Enable structured logging
LOG_FORMAT=json
LOG_ENABLE_TIMESTAMPS=true
LOG_ENABLE_COLORS=true

# Metrics collection
METRICS_ENABLED=true
METRICS_MAX_EVENTS=1000
METRICS_EXPORT_INTERVAL_SECONDS=300

# =============================================================================
# RAG System Configuration
# =============================================================================

# Embedding model preferences (ordered by priority)
EMBEDDING_MODEL_PRIMARY=OpenAI
EMBEDDING_MODEL_SECONDARY=Cohere
EMBEDDING_MODEL_FALLBACK=Mock

# Chunk settings
RAG_MAX_CHUNK_SIZE=512
RAG_CHUNK_OVERLAP=50

# Features
RAG_ENABLE_CODE_ANALYSIS=true
RAG_AUTO_DETECT_PROJECTS=true
RAG_ENABLE_CIRCUIT_BREAKER=true

# =============================================================================
# Performance Tuning
# =============================================================================

# Request batching
EMBEDDING_MAX_BATCH_SIZE=32
EMBEDDING_BATCH_TIMEOUT_MS=100

# Connection pooling
HTTP_MAX_CONNECTIONS_PER_HOST=10
HTTP_CONNECTION_TIMEOUT_SECONDS=10
HTTP_IDLE_TIMEOUT_SECONDS=30

# Memory limits
MAX_CACHED_EMBEDDINGS=10000
MAX_CACHED_RESULTS=1000
MAX_EVENT_HISTORY=5000

# =============================================================================
# Development/Testing
# =============================================================================

# Enable testing mode with mock services
TEST_MODE=false

# Simulate failures for testing
TEST_SIMULATE_FAILURES=false
TEST_FAILURE_RATE=0.1
TEST_LATENCY_MS=100

# Development features
DEV_ENABLE_DETAILED_METRICS=true
DEV_ENABLE_CIRCUIT_BREAKER_UI=false
DEV_RESET_CIRCUIT_BREAKERS_ON_START=false