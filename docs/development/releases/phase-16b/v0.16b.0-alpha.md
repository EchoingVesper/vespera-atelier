# Release Notes: v0.16b.0-alpha - Project-Centric UI Integration

**Version**: v0.16b.0-alpha
**Phase**: Phase 16b - Project-Centric UI Integration
**Date**: 2025-10-24
**Status**: Pre-release (Alpha)

---

## Summary

This release brings the project-centric architecture to life with a functional user interface. Projects are now fundamental to the Vespera Forge experience‚Äîusers create projects, switch between them, and all codices are organized within project contexts. The Navigator successfully filters and displays codices by active project, completing the core end-to-end workflow from project creation through codex display.

While some polish features and the codex editor remain incomplete, this release establishes the essential project-aware foundation for all future work.

## What's New

### ‚ú® New Features

- **Project Context Management**: Complete React-based state management for active projects
  - ProjectContext provider wraps the entire extension UI
  - Active project persists across extension reloads via VS Code workspace state
  - Real-time UI updates when projects change
  - Impact: Projects are now the central organizing principle throughout the extension

- **Welcome Screen for First-Time Users**: Guides new users to create their first project
  - Appears automatically when no projects exist
  - Project type selection with visual cards
  - Direct integration with project creation wizard
  - Impact: Clear onboarding flow replaces empty/confusing initial state

- **Multi-Step Project Creation Wizard**: Native VS Code QuickPick interface for creating projects
  - Step 1: Select project type (fiction, journalism, research, personal knowledge, software, etc.)
  - Step 2: Enter project name with validation
  - Step 3: Optional description
  - Full integration with ProjectService for persistence
  - Impact: Easy, guided project setup without leaving VS Code

- **Project Switcher in Navigator**: Dropdown for quick project switching
  - Shows all projects with active project indicator
  - Create new project action
  - Delete project action with auto-switch to remaining project
  - Smooth tree refresh on project change
  - Impact: Fast context switching between projects

- **Project-Aware Navigator Tree**: Codices automatically filter by active project
  - Real-time filtering when project changes
  - Project name and type displayed in Navigator header
  - Empty state message when no codices exist in project
  - Codices display successfully after creation
  - Impact: Clean, focused view of project-specific content

- **Database Persistence for Codices**: SQLite backend stores codices with project relationships
  - Full CRUD operations (create, read, update, delete, list)
  - `project_id` foreign key on codices table
  - Cascade delete when project removed
  - Impact: Codices properly scoped to projects at database level

### üîß Improvements

- **Bindery JSON-RPC Server**: Fixed critical async I/O deadlock
  - Replaced blocking `std::io::stdin()` with `tokio::io::stdin()`
  - Configured multi-threaded Tokio runtime (4 worker threads)
  - All database operations now complete successfully
  - Impact: Reliable backend communication, no more 5-second timeouts

- **Efficient API Design**: list_codices returns full objects instead of just IDs
  - Eliminated N+1 query problem (was fetching each codex individually)
  - Single API call returns all necessary data
  - Client-side filtering by project_id
  - Impact: Faster Navigator loading, cleaner code architecture

- **Project Deletion with Cascade**: Deleting a project removes all associated codices
  - Database-level cascade delete ensures no orphaned data
  - UI automatically switches to another project after deletion
  - Impact: Clean project lifecycle management

### üêõ Bug Fixes

- **Fixed: Database operations hanging indefinitely**
  - Issue: All Bindery operations (list_codices, create_codex) timed out after 5 seconds
  - Root cause: Synchronous stdin/stdout blocking async runtime thread
  - Resolution: Converted to async I/O using tokio primitives
  - Commits: `9917411`, `b4738a3`

- **Fixed: Navigator showing empty codices array**
  - Issue: Codices created successfully but not appearing in Navigator
  - Root cause: `list_codices` SQL query didn't return `project_id` field
  - Resolution: Added `project_id` to SELECT statement
  - Impact: Navigator now displays codices correctly
  - Commit: `81707ac`

- **Fixed: "Missing codex_id parameter" errors**
  - Issue: Extension making repeated failing calls to get_codex
  - Root cause: API contract mismatch‚Äîexpected IDs, got full objects
  - Resolution: Process full objects directly from list_codices response
  - Impact: Eliminated errors and improved efficiency
  - Commit: `080dfff`

- **Fixed: Schema initialization hanging on server startup**
  - Issue: Bindery server hung during database initialization
  - Root cause: SQLite/sqlx doesn't support multi-statement SQL in single execute()
  - Resolution: Split init_schema() into individual CREATE TABLE statements
  - Commit: `b4738a3`

### üìö Documentation

- **Phase 16b Completion Report**: Comprehensive 832-line completion document
  - Full implementation details and challenges
  - Technical debt tracking
  - Context handover for future sessions
  - Location: `docs/development/phases/PHASE_16b_COMPLETE.md`

- **Stage 3 Handover Document**: Mid-phase context preservation
  - Critical for context window transition
  - Location: `docs/development/handovers/HANDOVER_2025-10-24-2030.md`

### ‚öôÔ∏è Technical Changes

- **ProjectContext Pattern**: Centralized React state management for projects
  - New context provider at application root
  - Replaces prop drilling through component tree
  - Location: `plugins/VSCode/vespera-forge/src/contexts/ProjectContext.tsx`

- **Async I/O Throughout Bindery**: Complete migration to tokio
  - tokio::io::AsyncBufReadExt for reading
  - tokio::io::AsyncWriteExt for writing
  - Multi-threaded runtime configuration
  - Location: `packages/vespera-utilities/vespera-bindery/src/bin/server.rs`

- **Client-Side Project Filtering**: Extension filters codices by active project
  - Server returns all data with project_id included
  - Client handles filtering logic
  - Simpler server implementation, more flexible client
  - Location: `plugins/VSCode/vespera-forge/src/views/NavigatorWebviewProvider.ts`

## Breaking Changes

‚ö†Ô∏è **All codices now require project_id**
- **What changed**: Codices can no longer be created without an associated project
- **Migration path**: Existing codices without project_id would not be displayed (though none should exist in current alpha state)
- **Rationale**: Projects are fundamental to the architecture‚Äîthis enforces clean data model

‚ö†Ô∏è **Bindery API contract changed**
- **What changed**: list_codices now returns full codex objects instead of ID strings
- **Impact**: Any direct Bindery API consumers must process objects instead of fetching IDs then calling get_codex
- **Rationale**: Eliminates N+1 queries, improves performance

## Known Issues

- **Codex Editor Not Loading Content** (HIGH SEVERITY)
  - **Impact**: Users can create codices but cannot edit them yet
  - **Description**: When clicking a codex in Navigator, editor panel opens but displays "No Codex Selected" instead of loading content
  - **Root Cause**: EditorWebviewProvider not yet integrated with Bindery backend for codex retrieval
  - **Workaround**: None‚Äîediting functionality not available in this release
  - **Status**: Planned as highest priority for Phase 17
  - **Tracking**: See Phase 16b completion doc, section "Known Issues"

- **Template Filtering Not Implemented**
  - **Impact**: Users see all templates regardless of project type
  - **Description**: Infrastructure exists but filtering logic not yet connected
  - **Workaround**: Manually select appropriate templates for your project type
  - **Status**: Planned for Phase 17

- **Extension Reload Required After Code Changes** (LOW SEVERITY - EXPECTED)
  - **Impact**: Developers must reload extension after compilation
  - **Description**: Standard VS Code extension behavior‚Äîno hot reload
  - **Workaround**: Use `F1 ‚Üí Developer: Reload Window` after `npm run compile`
  - **Status**: Not an issue‚Äîexpected VS Code behavior

- **207 TypeScript Compilation Warnings**
  - **Impact**: None‚Äîextension compiles and runs successfully
  - **Description**: Linting warnings (unused variables, type mismatches) in existing codebase
  - **Status**: Incremental cleanup planned, doesn't block functionality

## Technical Debt Addressed

- **Cleaned up API inefficiency**: Eliminated N+1 query pattern where list_codices returned IDs requiring individual get_codex calls
- **Fixed async runtime blocking**: Converted all I/O to async, preventing runtime thread starvation

## Technical Debt Added

- **Codex Editor Implementation Missing** (HIGH PRIORITY)
  - **Location**: `plugins/VSCode/vespera-forge/src/views/EditorWebviewProvider.ts`
  - **Description**: Editor panel exists but doesn't load/display codex content
  - **Estimated effort**: 4-6 hours
  - **Plan**: Integrate with Bindery backend, implement template-driven form rendering

- **Template Filtering Incomplete** (MEDIUM PRIORITY)
  - **Location**: Template loading throughout extension
  - **Description**: Infrastructure ready but filtering by project type not implemented
  - **Estimated effort**: 2-3 hours
  - **Plan**: Connect filtering logic to template loading

- **No Unit Tests for New Components** (MEDIUM PRIORITY)
  - **Location**: ProjectContext, WelcomeScreen, createProjectWizard
  - **Description**: Manual integration testing only, no automated coverage
  - **Estimated effort**: 6-8 hours
  - **Plan**: Add tests in Phase 17 or dedicated testing phase

- **No Project Status Bar Indicator** (LOW PRIORITY)
  - **Description**: Deferred Stage 4 feature‚Äîno visual indicator of active project in status bar
  - **Estimated effort**: 1-2 hours
  - **Plan**: Low priority for Phase 17, project shown in Navigator header instead

## Performance Notes

- **Improved Navigator loading**: Single list_codices call replaces N+1 get_codex calls, reducing database round trips by 90%+ for typical projects
- **Async I/O prevents blocking**: Multi-threaded Tokio runtime allows concurrent operations without hanging

## Dependencies

### Added

- None (used existing dependencies)

### Updated

- `tokio` features: Added `io-util` for async stdin/stdout
  - **Reason**: Required for async I/O conversion

## Testing

- **Test Coverage**: Manual integration testing only
- **New Tests**: None (technical debt for Phase 17)
- **Testing Notes**:
  - End-to-end flow validated: project creation ‚Üí codex creation ‚Üí Navigator display
  - User confirmation: "Finally! You did it! Those 2 Codices I made have appeared!"
  - All manual test cases passed (see Phase 16b completion doc for detailed test matrix)

## Installation / Upgrade

### New Installation

```bash
# Clone repository
git clone https://github.com/yourusername/vespera-atelier.git
cd vespera-atelier

# Install extension dependencies
cd plugins/VSCode/vespera-forge
npm install
npm run compile

# Build Bindery server
cd ../../../packages/vespera-utilities/vespera-bindery
cargo build --release

# Install extension in VS Code
# F5 in extension directory to launch Extension Development Host
```

### Upgrading from Phase 16a

No special migration needed‚Äîdatabase schema added automatically on first run.

**Important**: If upgrading from Phase 16a, run `cargo clean` before building Bindery to ensure async I/O changes compile correctly.

## Contributors

- Claude Code (Sonnet 4.5) - Implementation assistance
- User (aya) - Architecture, testing, debugging

## Related Documentation

- [Phase 16b Completion Report](../../phases/PHASE_16b_COMPLETE.md) - Full implementation details
- [Phase 16b Handover Document](../../handovers/HANDOVER_2025-10-24-2030.md) - Stage 3 context
- [Phase 17 Plan](../../phases/PHASE_17_PLAN.md) - Next phase roadmap

**Related ADRs**:
- [ADR-001: Projects as Fundamental](../../decisions/ADR-001-projects-fundamental.md) - Core architecture
- [ADR-004: Dynamic Templates Over Hardcoded Types](../../decisions/ADR-004-dynamic-templates.md) - Template system
- [ADR-007: Codex-Based Folders](../../decisions/ADR-007-codex-folders.md) - Navigator structure

## Commits

**Key Commits** (chronological order):

**Stage 1 (Core Integration)**:
- `2a1f72f` - feat(phase-16b): Stage 1 - Core project integration complete

**Stage 2 (Project Creation)**:
- `34e5b28` - feat(phase-16b): Stage 2 - Project creation wizard complete

**Stage 3 (Template & Codex Integration)**:
- `362b2bb` - fix(phase-16b): Pass projectId when creating codices
- `2c81086` - feat(phase-16b): Add strict projectId validation and logging
- `6100747` - fix(phase-16b): Remove folder grouping in project view
- `d58eba0` - feat(phase-16b): Add database persistence for codices
- `1fb6681` - feat(phase-16b): Stage 3 - Add project context to Codex creation
- `1464431` - feat(phase-16b): Stage 3 - Project filtering and deletion UI

**Critical Fixes**:
- `b4738a3` - fix(bindery): Fix server hang on list_codices by splitting init_schema
- `9917411` - fix(bindery): Fix async I/O deadlock causing list_codices and create_codex to hang
- `81707ac` - fix(bindery): Include project_id in list_codices results for client-side filtering
- `080dfff` - fix(vespera-forge): Fix Navigator to process full codex objects from list_codices

**Documentation**:
- `519a01f` - docs: Add handover document for Phase 16b Stage 3 completion
- `5f62763` - docs: Phase 16b completion - Project-centric UI integration

**Full diff**: Compare `main` branch with Phase 16b work (commit range: `2a1f72f..5f62763`)

---

## For Next Release

**Planned for Phase 17 (v0.17.0-alpha)**:
- Codex editor/viewer implementation (HIGH PRIORITY)
- Template filtering by project type
- Project status bar indicator
- Command palette actions for projects
- Keyboard shortcuts for common operations

**Not Ready for General Use**:

This is an early-stage alpha release. The editor is not yet functional, so while you can create projects and codices, you cannot edit them. Check back when Phase 17+ is complete for a more usable experience.

**Feedback Welcome**:

This is a solo development project. If you're testing the alpha, please report issues via GitHub Issues with:
- Steps to reproduce
- Expected vs actual behavior
- VS Code version and OS
- Relevant logs from Developer Tools console

---

*This release is part of the incremental development of Vespera Atelier. See Phase 16b Completion Report for detailed context. Built incrementally by someone who needs it to exist.*
